--[[
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    AVATAR CHANGER SYSTEM - SERVER SIDE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Author: ItoRenz00
    Description: Server-side avatar handler with preloading & caching
    Location: ServerScriptService
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ContentProvider = game:GetService("ContentProvider")

local COOLDOWN_TIME = 2
local MAX_RETRY_ATTEMPTS = 3
local RETRY_DELAY = 0.3
local PBR_PRELOAD_DELAY = 0.5
local DEBUG_MODE = false -- Set true untuk detailed logs
local ENABLE_PRELOADING = true
local PRELOAD_TIMEOUT = 120
local WAIT_FOR_DATA_TIMEOUT = 60
local SHOW_PRELOAD_PROGRESS = false -- Set true untuk progress updates

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- REMOTE EVENTS SETUP
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local RemoteEvent = ReplicatedStorage:FindFirstChild("ChangeAvatar")
if not RemoteEvent then
    RemoteEvent = Instance.new("RemoteEvent")
    RemoteEvent.Name = "ChangeAvatar"
    RemoteEvent.Parent = ReplicatedStorage
end

local RefreshTitleEvent = ReplicatedStorage:FindFirstChild("RefreshTitle")
if not RefreshTitleEvent then
    RefreshTitleEvent = Instance.new("RemoteEvent")
    RefreshTitleEvent.Name = "RefreshTitle"
    RefreshTitleEvent.Parent = ReplicatedStorage
end

local AvatarEffectEvent = ReplicatedStorage:FindFirstChild("AvatarEffectTrigger")
if not AvatarEffectEvent then
    AvatarEffectEvent = Instance.new("RemoteEvent")
    AvatarEffectEvent.Name = "AvatarEffectTrigger"
    AvatarEffectEvent.Parent = ReplicatedStorage
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DATA STORAGE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Cooldowns = {}
local SavedAvatars = {}
local OriginalAvatars = {}

local AvatarDescriptionCache = {}
local AvatarAssetCache = {}
local CacheStatus = {
    isPreloading = false,
    totalAvatars = 0,
    loadedAvatars = 0,
    failedAvatars = 0,
    isReady = false,
    startTime = 0,
    endTime = 0
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UTILITY FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function debugLog(...)
    if DEBUG_MODE then
        print("[AvatarChanger]", ...)
    end
end

local function getRigType(character)
    if not character then return nil end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return nil end
    return humanoid.RigType
end

local function getRigTypeName(rigType)
    if rigType == Enum.HumanoidRigType.R6 then
        return "R6"
    elseif rigType == Enum.HumanoidRigType.R15 then
        return "R15"
    end
    return "Unknown"
end

local function isOnCooldown(playerId)
    if Cooldowns[playerId] then
        local timeLeft = Cooldowns[playerId] - os.clock()
        if timeLeft > 0 then
            return true, timeLeft
        end
    end
    return false, 0
end

local function setCooldown(playerId)
    Cooldowns[playerId] = os.clock() + COOLDOWN_TIME
end

local function isValidUserId(userId)
    return typeof(userId) == "number" and userId > 0
end

local function isAvatarAllowed(userId)
    local AvatarStorage = ReplicatedStorage:FindFirstChild("AvatarStorage")
    if not AvatarStorage then return false end
    
    local BoyFolder = AvatarStorage:FindFirstChild("Boy")
    local GirlFolder = AvatarStorage:FindFirstChild("Girl")
    
    if BoyFolder then
        for _, value in ipairs(BoyFolder:GetChildren()) do
            if value:IsA("IntValue") and value.Value == userId then
                return true
            end
        end
    end
    
    if GirlFolder then
        for _, value in ipairs(GirlFolder:GetChildren()) do
            if value:IsA("IntValue") and value.Value == userId then
                return true
            end
        end
    end
    
    return false
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- WAIT FOR AVATAR DATA
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function waitForAvatarData()
    local AvatarStorage = ReplicatedStorage:WaitForChild("AvatarStorage", WAIT_FOR_DATA_TIMEOUT)
    if not AvatarStorage then
        warn("âŒ AvatarStorage not found!")
        return false
    end
    
    local DataReady = AvatarStorage:WaitForChild("DataReady", WAIT_FOR_DATA_TIMEOUT)
    if not DataReady then
        warn("âŒ DataReady flag not found!")
        return false
    end
    
    local startWait = tick()
    while not DataReady.Value and (tick() - startWait) < WAIT_FOR_DATA_TIMEOUT do
        task.wait(0.1)
    end
    
    if not DataReady.Value then
        warn("âŒ AvatarDataLoader timeout!")
        return false
    end
    
    debugLog("âœ… AvatarData is ready!")
    return true
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CACHE & PRELOADING SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function getAllAvatarUserIds()
    local userIds = {}
    local AvatarStorage = ReplicatedStorage:FindFirstChild("AvatarStorage")
    if not AvatarStorage then return userIds end
    
    local BoyFolder = AvatarStorage:FindFirstChild("Boy")
    local GirlFolder = AvatarStorage:FindFirstChild("Girl")
    
    if BoyFolder then
        for _, value in ipairs(BoyFolder:GetChildren()) do
            if value:IsA("IntValue") and value.Value > 0 then
                table.insert(userIds, {
                    userId = value.Value,
                    username = value.Name,
                    category = "Boy"
                })
            end
        end
    end
    
    if GirlFolder then
        for _, value in ipairs(GirlFolder:GetChildren()) do
            if value:IsA("IntValue") and value.Value > 0 then
                table.insert(userIds, {
                    userId = value.Value,
                    username = value.Name,
                    category = "Girl"
                })
            end
        end
    end
    
    return userIds
end

local function getAvatarAssets(description)
    if not description then return {} end
    
    local assets = {}
    
    local assetProperties = {
        "Face", "Head", "Torso", "LeftArm", "RightArm", "LeftLeg", "RightLeg",
        "HatAccessory", "HairAccessory", "FaceAccessory", "NeckAccessory",
        "ShoulderAccessory", "FrontAccessory", "BackAccessory", "WaistAccessory",
        "ClimbAnimation", "FallAnimation", "IdleAnimation", "JumpAnimation",
        "RunAnimation", "SwimAnimation", "WalkAnimation"
    }
    
    for _, prop in ipairs(assetProperties) do
        local success, value = pcall(function()
            return description[prop]
        end)
        
        if success and value then
            if typeof(value) == "string" and value ~= "" then
                table.insert(assets, value)
            elseif typeof(value) == "number" and value > 0 then
                table.insert(assets, "rbxassetid://" .. value)
            end
        end
    end
    
    return assets
end

local function preloadAvatarDescription(userId, username)
    if AvatarDescriptionCache[userId] then
        debugLog("Cache hit:", username)
        return AvatarDescriptionCache[userId]
    end
    
    local description = nil
    local lastError = nil
    
    for attempt = 1, MAX_RETRY_ATTEMPTS do
        local success, result = pcall(function()
            return Players:GetHumanoidDescriptionFromUserId(userId)
        end)
        
        if success and result then
            description = result
            break
        else
            lastError = result
            if attempt < MAX_RETRY_ATTEMPTS then
                task.wait(RETRY_DELAY)
            end
        end
    end
    
    if description then
        AvatarDescriptionCache[userId] = description
        local assets = getAvatarAssets(description)
        AvatarAssetCache[userId] = assets
        debugLog("Cached:", username, "-", #assets, "assets")
        return description
    else
        if DEBUG_MODE then
            warn("Failed to preload:", username, lastError)
        end
        return nil
    end
end

local function preloadAvatarAssets(userId, username)
    local assets = AvatarAssetCache[userId]
    if not assets or #assets == 0 then
        return false
    end
    
    local success, err = pcall(function()
        ContentProvider:PreloadAsync(assets)
    end)
    
    if success then
        debugLog("Preloaded assets:", username)
        return true
    else
        if DEBUG_MODE then
            warn("Asset preload failed:", username, err)
        end
        return false
    end
end

local function preloadAllAvatars()
    if not ENABLE_PRELOADING then
        CacheStatus.isReady = true
        return
    end
    
    CacheStatus.isPreloading = true
    CacheStatus.startTime = tick()
    
    local avatarList = getAllAvatarUserIds()
    CacheStatus.totalAvatars = #avatarList
    
    if #avatarList == 0 then
        warn("âš ï¸ No avatars found in AvatarStorage!")
        CacheStatus.isReady = true
        CacheStatus.isPreloading = false
        return
    end
    
    if SHOW_PRELOAD_PROGRESS then
        print("ğŸ”„ Preloading", #avatarList, "avatars...")
    end
    
    local startTime = tick()
    local loadedCount = 0
    local failedCount = 0
    
    -- Phase 1: Preload descriptions
    for i, data in ipairs(avatarList) do
        if tick() - startTime > PRELOAD_TIMEOUT then
            warn("â° Preload timeout!")
            break
        end
        
        local description = preloadAvatarDescription(data.userId, data.username)
        
        if description then
            loadedCount = loadedCount + 1
            CacheStatus.loadedAvatars = loadedCount
        else
            failedCount = failedCount + 1
            CacheStatus.failedAvatars = failedCount
        end
        
        if SHOW_PRELOAD_PROGRESS and (i % 20 == 0 or i == #avatarList) then
            print(string.format("Progress: %d/%d", i, #avatarList))
        end
        
        task.wait(0.05)
    end
    
    -- Phase 2: Preload assets
    local assetCount = 0
    for userId, _ in pairs(AvatarDescriptionCache) do
        local username = "Unknown"
        for _, data in ipairs(avatarList) do
            if data.userId == userId then
                username = data.username
                break
            end
        end
        
        if preloadAvatarAssets(userId, username) then
            assetCount = assetCount + 1
        end
        task.wait(0.05)
    end
    
    CacheStatus.endTime = tick()
    local elapsed = CacheStatus.endTime - CacheStatus.startTime
    
    -- ONLY SHOW SUMMARY
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("âœ… AVATAR CACHE READY")
    print("ğŸ‘¤ Author: ItoRenz00")
    print("ğŸ“¦ Loaded:", loadedCount, "| Failed:", failedCount, "| Time:", string.format("%.1f", elapsed) .. "s")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    
    CacheStatus.isReady = true
    CacheStatus.isPreloading = false
end

local function getCachedDescription(userId)
    return AvatarDescriptionCache[userId]
end

local function clearCache()
    AvatarDescriptionCache = {}
    AvatarAssetCache = {}
    CacheStatus.loadedAvatars = 0
    CacheStatus.failedAvatars = 0
    CacheStatus.isReady = false
    print("ğŸ§¹ Avatar cache cleared")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AVATAR FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function preloadPBRTextures(character, playerName)
    task.wait(PBR_PRELOAD_DELAY)
    if not character or not character.Parent then
        return
    end
    
    local surfaceAppearances = {}
    for _, descendant in pairs(character:GetDescendants()) do
        if descendant:IsA("SurfaceAppearance") then
            table.insert(surfaceAppearances, descendant)
        end
    end
    
    if #surfaceAppearances > 0 then
        local success, err = pcall(function()
            ContentProvider:PreloadAsync(surfaceAppearances)
        end)
        
        if success then
            debugLog("PBR preloaded:", playerName, #surfaceAppearances, "surfaces")
        elseif DEBUG_MODE then
            warn("PBR preload failed:", playerName, err)
        end
    end
end

local function saveOriginalAvatar(player)
    if OriginalAvatars[player.UserId] then
        return
    end
    
    local character = player.Character
    if not character then
        return
    end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then
        return
    end
    
    local success, description = pcall(function()
        return humanoid:GetAppliedDescription()
    end)
    
    if success and description then
        OriginalAvatars[player.UserId] = description
        debugLog("Saved original avatar:", player.Name)
    end
end

local function applyAvatar(player, userId, skipSave, isReset)
    if not player or not player.Parent then
        return false
    end
    
    if not isValidUserId(userId) then
        if DEBUG_MODE then
            warn("Invalid UserId:", userId)
        end
        return false
    end
    
    local onCooldown, timeLeft = isOnCooldown(player.UserId)
    if onCooldown then
        return false
    end
    
    if not isReset and not isAvatarAllowed(userId) and userId ~= player.UserId then
        if DEBUG_MODE then
            warn("Unauthorized avatar:", userId)
        end
        return false
    end
    
    local character = player.Character
    if not character then
        return false
    end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then
        return false
    end
    
    local description = nil
    
    if isReset and OriginalAvatars[player.UserId] then
        description = OriginalAvatars[player.UserId]
        debugLog("Reset avatar:", player.Name)
    else
        description = getCachedDescription(userId)
        
        if description then
            debugLog("Cache load:", player.Name)
        else
            local lastError = nil
            for attempt = 1, MAX_RETRY_ATTEMPTS do
                local success, result = pcall(function()
                    return Players:GetHumanoidDescriptionFromUserId(userId)
                end)
                if success and result then
                    description = result
                    AvatarDescriptionCache[userId] = description
                    break
                else
                    lastError = result
                    if attempt < MAX_RETRY_ATTEMPTS then
                        task.wait(RETRY_DELAY)
                    end
                end
            end
            if not description then
                if DEBUG_MODE then
                    warn("Failed to get description:", userId, lastError)
                end
                return false
            end
        end
    end
    
    task.spawn(function()
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        local originalAnchored = rootPart and rootPart.Anchored or false
        if rootPart then
            rootPart.Anchored = true
        end
        
        local success, error = pcall(function()
            humanoid:ApplyDescription(description)
        end)
        
        if not success then
            if DEBUG_MODE then
                warn("Apply failed:", error)
            end
            if rootPart then
                rootPart.Anchored = originalAnchored
            end
            return
        end
        
        task.wait(0.05)
        
        local currentRigType = getRigType(character)
        if currentRigType then
            if currentRigType == Enum.HumanoidRigType.R15 then
                pcall(function()
                    humanoid:BuildRigFromAttachments()
                end)
            end
        end
        
        if rootPart then
            rootPart.Anchored = originalAnchored
        end
        
        if not skipSave then
            if isReset then
                SavedAvatars[player.UserId] = nil
            else
                SavedAvatars[player.UserId] = userId
            end
        end
        
        debugLog("Avatar changed:", player.Name)
        setCooldown(player.UserId)
        
        task.spawn(function()
            preloadPBRTextures(character, player.Name)
        end)
        
        task.wait(0.2)
        if RefreshTitleEvent then
            pcall(function()
                RefreshTitleEvent:FireAllClients(player.UserId)
            end)
        end
    end)
    
    return true
end

local function setupRespawnHandler(player)
    player.CharacterAdded:Connect(function(character)
        task.wait(0.1)
        saveOriginalAvatar(player)
        
        local savedUserId = SavedAvatars[player.UserId]
        if savedUserId and savedUserId ~= player.UserId then
            debugLog("Respawn reapply:", player.Name)
            task.spawn(function()
                applyAvatar(player, savedUserId, true)
            end)
        end
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- EVENT HANDLERS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RemoteEvent.OnServerEvent:Connect(function(player, userId)
    if not player or not player.Parent then
        return
    end
    
    local isReset = (userId == player.UserId)
    applyAvatar(player, userId, false, isReset)
end)

AvatarEffectEvent.OnServerEvent:Connect(function(player)
    if not player or not player.Parent then return end
    AvatarEffectEvent:FireAllClients(player.UserId)
end)

Players.PlayerAdded:Connect(function(player)
    setupRespawnHandler(player)
    
    if player.Character then
        saveOriginalAvatar(player)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    Cooldowns[player.UserId] = nil
    SavedAvatars[player.UserId] = nil
    OriginalAvatars[player.UserId] = nil
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ADMIN FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function clearCooldown(playerId)
    if Cooldowns[playerId] then
        Cooldowns[playerId] = nil
        return true
    end
    return false
end

local function clearAllCooldowns()
    local count = 0
    for _ in pairs(Cooldowns) do
        count = count + 1
    end
    Cooldowns = {}
    print("Cleared", count, "cooldowns")
end

local function resetAvatar(playerId)
    if SavedAvatars[playerId] then
        SavedAvatars[playerId] = nil
        return true
    end
    return false
end

_G.AvatarChanger = {
    ClearCooldown = clearCooldown,
    ClearAllCooldowns = clearAllCooldowns,
    ResetSavedAvatar = resetAvatar,
    GetCooldowns = function() return Cooldowns end,
    GetSavedAvatars = function() return SavedAvatars end,
    GetOriginalAvatars = function() return OriginalAvatars end,
    GetCacheStatus = function() return CacheStatus end,
    GetCachedAvatars = function() return AvatarDescriptionCache end,
    GetCachedAssets = function() return AvatarAssetCache end,
    ClearCache = clearCache,
    ReloadCache = function()
        clearCache()
        task.spawn(function()
            if waitForAvatarData() then
                preloadAllAvatars()
            end
        end)
    end,
    SetDebugMode = function(enabled)
        DEBUG_MODE = enabled
        print("Debug mode:", enabled and "ON" or "OFF")
    end
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- INITIALIZATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("âœ… AVATAR CHANGER SERVER READY")
print("ğŸ‘¤ Author: ItoRenz00")
print("âš™ï¸  Cooldown:", COOLDOWN_TIME .. "s | Cache:", ENABLE_PRELOADING and "ON" or "OFF")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")

task.spawn(function()
    if waitForAvatarData() then
        task.wait(1)
        preloadAllAvatars()
    else
        warn("âŒ Failed to load avatar data")
    end
end)
